### Применение условных вероятностей в анализе данных

## О датасете

Датасет ***Student Performance Dataset*** содержит информацию об успеваемости учащихся.

Всего 33 признака.

Целевая переменная: G3 - итоговая оценка по предмету в конце семестра. Это числовая переменная.
Дополнительные целевые переменные: G1 и G2 - оценки за первый и второй семестры соответственно.

Источник датасета: 
[Student Performance Dataset](https://www.kaggle.com/datasets/devansodariya/student-performance-data?resource=download)

---

## Описание признаков

Все признаки можно разделить на несколько логических групп:

- **Демографические и социальные признаки**

| Признак      | Описание                        | Возможные значения                           |
|--------------|---------------------------------|----------------------------------------------|
|`school`      | Школа                           | `GP`, `MS`                                   |
|`sex`         | Пол                             | `F` (женский), `M` (мужской)                 |
|`age`         | Возраст                         | от 15 до 22 лет                              |
|`address`     | Тип проживания                  | `U` (город), `R` (село)                      |
|`famsize`     | Размер семьи                    | `LE3` (<= 3 человека), `GT3` (>= 3 человека) |
|`Pstatus`     | Совместное проживание родителей | `T` (вместе), `A` (раздельно)                |

- **Образование родителей**

| Признак       | Описание                | Возможные значения                                  |
|---------------|-------------------------|-----------------------------------------------------|
|`Medu`         | Образование матери      | от 0 (нет) до 4 (высшее)                            |
|`Fedu`         | Образование отца        | от 0 (нет) до 4 (высшее)                            |
|`Mjob`, `Fjob` | Профессия матери / отца | `at_home`, `health`, `other`, `services`, `teacher` |

- **Мотивация и причины выбора школы**

| Признак   | Описание             | Возможные значения                      |
|-----------|----------------------|-----------------------------------------|
|`reason`   | Причина выбора школы | `course`, `home`, `other`, `reputation` |
|`guardian` | Опекун               | `father`, `mother`, `other`             |

- **Учебная среда и поддержка**

| Признак     | Описание                         | Возможные значения                                               |
|-------------|----------------------------------|------------------------------------------------------------------|
|`traveltime` | Время в пути от дома до школы    | 1 (менее 15 мин), 2 (15-30 мин), 3 (от 30 до 1 ч), 4 (более 1 ч) |
|`studytime`  | Время на учебу в неделю          | 1 (< 2 ч), 2 (2-5 ч), 3 (5-10 ч), 4 (>=10 ч)                     |
|`failures`   | Число прошлых неудач по предмету | от 0 до 3                                                        |
|`schoolsup`  | Доп. поддержка от школы          | `yes` / `no`                                                     |
|`famsup`     | Семейная поддержка               | `yes` / `no`                                                     |
|`paid`       | Платные дополнительные занятия   | `yes` / `no`                                                     |
|`activities` | Внеучебные активности            | `yes` / `no`                                                     |
|`nursery`    | Ходил в детский сад              | `yes` / `no`                                                     |
|`higher`     | Планирует ли поступать в вуз     | `yes` / `no`                                                     |

- **Технологии и образ жизни**

| Признак       | Описание                                 | Возможные значения                |
|---------------|------------------------------------------|-----------------------------------|
|`internet`     | Домашний интернет                        | `yes` / `no`                      |
|`romantic`     | В романтических отношениях               | `yes` / `no`                      |
|`famrel`       | Отношения в семье                        | от 1 (очень плохо) до 5 (отлично) |
|`freetime`     | Свободное время после школы              | от 1 до 5                         |
|`goout`        | Частота встреч с друзьями                | от 1 до 5                         |
|`Dalc`, `Walc` | Потребеление алкоголя (будние, выходные) | от 1 до 5                         |
|`health`       | Здоровье                                 | от 1 до 5                         |
|`absences`     | Количество пропусков (дней)              | от 0 до 75                        |

- **Итоговые оценки**

| Признак | Описание                 | Возможные значения |
|---------|--------------------------|--------------------|
|`G1`     | Оценка за первый семестр | от 0 до 20         |
|`G2`     | Оценка за второй семестр | от 0 до 20         |
|`G3`     | Итоговая оценка за год   | от 0 до 20         |

---

## Вычисление простых вероятностей

Вычислим некоторые априорные вероятности по формуле:

$$
P(A) = \frac{\text{Число случаев A}}{\text{Обшее число}}
$$

1. Вероятность получить высокую оценку.

``` python
P_high_grade = (data['G3'] >= 15).mean()
print(f'P(G3 >= 15) = {P_high_grade:.4f}')
```

$$
P(G3 >= 15) = 0.1848
$$

2. Вероятность посещать платные занятия.

```python
P_paid = (data['paid'] == 'yes').mean()
print(f'P(paid = yes) = {P_paid:.4f}')
```

$$
P(paid = yes) = 0.4582
$$

3. Вероятность иметь домашний интернет.

```python
P_internet = (data['internet'] == 'yes').mean()
print(f'P(internet = yes) = {P_internet:.4f}')
```

$$
P(internet = yes) = 0.8329
$$

---

## Вычисление условных вероятностей

Условную вероятность можно вычислить по следующей формуле:

$$
P(A | B) = \frac{P(AB)}(P(B)}
$$

1. Какова вероятность улучшить итоговую оценку, если студент посещает дополнительные платные занятия?

```python
# Способ 1: Вручную по формуле
data['high_grade'] = (data['G3'] >= 15)

P_high_paid = ((data['high_grade'] == True) & (data['paid'] == 'yes')).mean()
P_paid = (data['paid'] == 'yes').mean()
P = P_high_paid / P_paid

print(f'P(high_grade | paid = yes), рассчитанная вручную: {P:.4f}')
```

$$
\text{P(high grade | paid = yes), рассчитанная вручную: } 0.1768
$$

```python
# Способ 2: Просто отфильтровав датафрейм и посчитав среднее 
paid_yes = data[data['paid'] == 'yes']
P_filtered = paid_yes['high_grade'].mean()

print(f'P(high_grade | paid = yes), рассчитанная через фильтр: {P_filtered:.4f}')
```

$$
\text{P(high grade | paid = yes), рассчитанная через фильтр: } 0.1768
$$

2. Какова вероятность получить итоговую высокую оценку, если студент имеет семейную поддержку?

```python
# Способ 1: Вручную по формуле
P_high_famsup = ((data['high_grade'] == True) & (data['famsup'] == 'yes')).mean()
P_famsup = (data['famsup'] == 'yes').mean()
P = P_high_famsup / P_famsup

print(f'P(high_grade | famsup = yes), рассчитанная вручную: {P:.4f}')
```

$$
\text{P(high grade | famsup = yes), рассчитанная вручную: } 0.1736
$$

```python
# Способ 2: Просто отфильтровав датафрейм и посчитав среднее 
famsup_yes = data[data['famsup'] == 'yes']
P_filtered = famsup_yes['high_grade'].mean()

print(f'P(high_grade | famsup = yes), рассчитанная через фильтер: {P_filtered:.4f}')
```

$$
\text{P(high grade | famsup = yes), рассчитанная через фильтер: } 0.1736
$$

3. Какова вероятность, что студент живет в городе, если у него есть домашний интернет?

```python
# Способ 1: Вручную по формуле
P_urban_internet = ((data['address'] == 'U') & (data['internet'] == 'yes')).mean()
P_internet = (data['internet'] == 'yes').mean()
P = P_urban_internet / P_internet

print(f'P(address | internet = yes), рассчитанная вручную: {P:.4f}')
```

$$
\text{P(address | internet = yes), рассчитанная вручную: } 0.8176
$$

```python
# Способ 2: Просто отфильтровав датафрейм и посчитав среднее 
internet_yes = data[data['internet'] == 'yes']
P_filtered = (internet_yes['address'] == 'U').mean()

print(f'P(address | internet = yes), рассчитанная через фильтер: {P_filtered:.4f}')
```

$$
\text{P(address | internet = yes), рассчитанная через фильтер: } 0.8176
$$
